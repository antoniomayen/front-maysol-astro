---
---

<!-- Floating WhatsApp Container -->
<div id="floating-whatsapp-container" class="fixed bottom-6 right-6 z-40 2xl:right-[calc((100vw-1600px)/2+1.5rem)] hidden md:block">
  <button 
    id="floating-whatsapp"
    class="w-[200px] h-[200px] hover:scale-110 transition-all float-animation relative overflow-hidden group border-0 bg-transparent"
    aria-label="Contactar por WhatsApp"
  >
    <img 
      src="/images/agent_chat.png" 
      alt="WhatsApp Agent" 
      class="w-full h-full object-contain"
    />
    
    <!-- Fallback text for screen readers -->
    <span class="sr-only">WhatsApp</span>
  </button>
  
  <!-- Chat bubble message on hover -->
  <div 
    id="whatsapp-bubble"
    class="absolute bottom-full right-0 mb-4 bg-white text-gray-800 text-sm rounded-2xl opacity-0 pointer-events-none transition-all duration-300 shadow-lg max-w-[200px] group-hover:opacity-100 group-hover:translate-y-0 translate-y-2"
  >
    <div class="px-4 py-3">
      <div class="font-semibold mb-1">Â¡Hola! ðŸ‘‹</div>
      <div class="text-xs leading-relaxed">Â¿En quÃ© podemos ayudarte hoy?</div>
    </div>
    <!-- Chat bubble tail -->
    <div class="absolute -bottom-2 right-8">
      <svg class="w-4 h-4 text-white filter drop-shadow-md" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10 0 L15 10 L5 10 Z" transform="rotate(180 10 5)"/>
      </svg>
    </div>
  </div>
</div>

<style>
  
  /* Show chat bubble on hover */
  #floating-whatsapp:hover + #whatsapp-bubble {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Enhanced float animation */
  @keyframes float {
    0%, 100% { 
      transform: translateY(0px) rotate(0deg); 
    }
    25% { 
      transform: translateY(-8px) rotate(-2deg); 
    }
    75% { 
      transform: translateY(-5px) rotate(2deg); 
    }
  }
  
  .float-animation {
    animation: float 4s ease-in-out infinite;
  }
  
  /* Pulse animation */
  @keyframes ping {
    75%, 100% {
      transform: scale(2);
      opacity: 0;
    }
  }
  
  .animate-ping {
    animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
  }
</style>

<script>
  // Add click event listener
  document.getElementById('floating-whatsapp')?.addEventListener('click', () => {
    const modal = document.getElementById('whatsapp-modal') as HTMLDialogElement;
    if (modal) {
      modal.showModal();
    }
  });
  
  // Hide floating button when reaching footer
  document.addEventListener('DOMContentLoaded', () => {
    const floatingContainer = document.getElementById('floating-whatsapp-container');
    const footer = document.querySelector('footer');
    
    if (!floatingContainer || !footer) return;
    
    const handleScroll = () => {
      const footerRect = footer.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      
      // Check if footer is visible
      if (footerRect.top <= windowHeight) {
        // Hide button when footer is visible
        floatingContainer.style.opacity = '0';
        floatingContainer.style.pointerEvents = 'none';
      } else {
        // Show button when footer is not visible
        floatingContainer.style.opacity = '1';
        floatingContainer.style.pointerEvents = 'auto';
      }
    };
    
    // Add transition for smooth hide/show
    floatingContainer.style.transition = 'opacity 0.3s ease';
    
    window.addEventListener('scroll', handleScroll);
    handleScroll(); // Initial check
  });
</script>